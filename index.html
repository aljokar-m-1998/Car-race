<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Car Race</title>
  <style>
    :root{--bg:#0c0f14;--panel:#11151b;--accent:#2dd4bf;--text:#e5e7eb;--muted:#94a3b8;--danger:#ef4444}
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;overflow:hidden}
    #game{position:fixed;inset:0;width:100vw;height:100vh;background:linear-gradient(#0b0e13,#0a0d12)}
    #hud{position:fixed;top:12px;left:12px;display:flex;gap:12px;background:rgba(17,21,27,.6);backdrop-filter:blur(6px);padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.06);z-index:10}
    #hud div{font-weight:600}
    .overlay{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(180deg,rgba(12,15,20,.85),rgba(12,15,20,.95));z-index:20}
    .hidden{display:none}
    .card{width:min(92vw,420px);background:#11151b;border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:22px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
    h1,h2{margin:0 0 14px}
    label{display:block;font-size:.95rem;color:#94a3b8;margin-bottom:6px}
    select,button{width:100%;padding:12px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.1);background:#0f141b;color:#e5e7eb;font-weight:600;cursor:pointer}
    button{background:linear-gradient(135deg,#1f2937,#0f172a);transition:transform .08s ease}
    button:hover{transform:translateY(-1px)}
    #startBtn,#restartBtn{background:linear-gradient(135deg,#2563eb,#0891b2)}
    .hint{margin-top:10px;color:#94a3b8;font-size:.9rem}
    #gameover .card{border-color:rgba(239,68,68,.25)}
    #finalScore{font-size:1.1rem;margin:10px 0 14px}
    .touch{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);display:flex;align-items:flex-end;gap:18px;z-index:30}
    .btn{width:84px;height:84px;border-radius:50%;background:rgba(17,21,27,.7);border:1px solid rgba(255,255,255,.1);font-size:28px;color:#e5e7eb}
    .vcol{display:flex;flex-direction:column;gap:10px}
    .small{width:84px;height:40px;border-radius:12px}
    @media (min-width:900px){.touch{display:none!important}}
  </style>
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
  <canvas id="game"></canvas>
  <div id="hud">
    <div id="score">Score: 0</div>
    <div id="time">Time: 0.0s</div>
    <div id="speed">Speed: 0</div>
  </div>
  <div id="menu" class="overlay">
    <div class="card">
      <h1>3D Car Race</h1>
      <label>Difficulty</label>
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="normal" selected>Normal</option>
        <option value="hard">Hard</option>
      </select>
      <button id="startBtn">Start</button>
      <p class="hint">Touch controls on mobile. Use arrow keys on desktop.</p>
    </div>
  </div>
  <div id="gameover" class="overlay hidden">
    <div class="card">
      <h2>Game Over</h2>
      <p id="finalScore">Score: 0</p>
      <button id="restartBtn">Restart</button>
    </div>
  </div>
  <div id="touchControls" class="touch hidden">
    <button class="btn" id="leftBtn">⟵</button>
    <div class="vcol">
      <button class="btn small" id="brakeBtn">▮▮</button>
      <button class="btn small" id="accelBtn">▲</button>
    </div>
    <button class="btn" id="rightBtn">⟶</button>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const renderer = new THREE.WebGLRenderer({canvas, antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x20232a);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0,5,10);

    const light = new THREE.DirectionalLight(0xffffff,1);
    light.position.set(5,10,7.5);
    scene.add(light);

    const ambient = new THREE.AmbientLight(0x404040);
    scene.add(ambient);

    const carGeometry = new THREE.BoxGeometry(1,0.5,2);
    const carMaterial = new THREE.MeshStandardMaterial({color:0xff0000});
    const car = new THREE.Mesh(carGeometry,carMaterial);
    scene.add(car);

    const roadGeometry = new THREE.PlaneGeometry(20,200);
    const roadMaterial = new THREE.MeshStandardMaterial({color:0x333333});
    const road = new THREE.Mesh(roadGeometry,roadMaterial);
    road.rotation.x = -Math.PI/2;
    scene.add(road);

    let keys = {};
    window.addEventListener('keydown',(e)=>{keys[e.key]=true});
    window.addEventListener('keyup',(e)=>{keys[e.key]=false});

    function animate(){
      requestAnimationFrame(animate);

      if(keys['ArrowUp']) car.position.z -= 0.2;
      if(keys['ArrowDown']) car.position.z += 0.2;
      if(keys['ArrowLeft']) car.position.x -= 0.1;
      if(keys['ArrowRight']) car.position.x += 0.1;

      renderer.render(scene,camera);
    }
    animate();
  </script>
</body>
</html>
